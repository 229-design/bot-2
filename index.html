import telebot
from telebot import types
import json

TOKEN = "8038890774:AAFRg97wH8psYM7XxUpltSMGItwmq2riq9Y"
WEB_APP_URL = "https://229-design.github.io/bot-2/" 
MODERATION_GROUP_ID = -1003774378236 

bot = telebot.TeleBot(TOKEN, threaded=False)

@bot.message_handler(commands=['start'])
def start(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    btn = types.KeyboardButton("ğŸ› Ouvrir Neo Boutique", web_app=types.WebAppInfo(WEB_APP_URL))
    markup.add(btn)
    bot.send_message(message.chat.id, "ğŸŒŒ <b>BIENVENUE DANS LE FUTUR</b>\n\nLancez l'app pour voir nos produits exclusifs.", parse_mode="HTML", reply_markup=markup)

@bot.message_handler(content_types=['web_app_data'])
def handle_data(message):
    try:
        data = json.loads(message.web_app_data.data)
        username = f"@{message.from_user.username}" if message.from_user.username else message.from_user.first_name
        summary = "".join([f"â€¢ {i['name']} ({i['size']}) x{i['qty']}\n" for i in data])
        
        bot.send_message(message.chat.id, f"âœ… <b>Commande enregistrÃ©e !</b>\n\n{summary}")
        bot.send_message(MODERATION_GROUP_ID, f"ğŸš¨ <b>NEW ORDER</b>\nğŸ‘¤ Client: {username}\n{summary}")
    except Exception as e:
        print(f"Error: {e}")

if __name__ == "__main__":
    bot.remove_webhook()
    print("ğŸš€ Neo App Online")
    bot.infinity_polling()
